/*! For license information please see 956.61770f21fa231b6605ff.js.LICENSE.txt */
"use strict";(self.webpackChunkjupyterlab_myst=self.webpackChunkjupyterlab_myst||[]).push([[701,956,4848],{21020:(e,t,r)=>{var s=r(93345),n=Symbol.for("react.element"),o=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,a=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,d={key:!0,ref:!0,__self:!0,__source:!0};function l(e,t,r){var s,o={},l=null,c=null;for(s in void 0!==r&&(l=""+r),void 0!==t.key&&(l=""+t.key),void 0!==t.ref&&(c=t.ref),t)i.call(t,s)&&!d.hasOwnProperty(s)&&(o[s]=t[s]);if(e&&e.defaultProps)for(s in t=e.defaultProps)void 0===o[s]&&(o[s]=t[s]);return{$$typeof:n,type:e,key:l,ref:c,props:o,_owner:a.current}}t.Fragment=o,t.jsx=l,t.jsxs=l},74848:(e,t,r)=>{e.exports=r(21020)},90956:(e,t,r)=>{r.r(t),r.d(t,{default:()=>ce});var s=r(51168),n=r(62393),o=r(96766),i=r(56797),a=r(13603),d=r(49334);const l="user_expressions";function c(e){var t;return e.model.getMetadata?e.model.getMetadata(l):null===(t=e.model.metadata)||void 0===t?void 0:t.get(l)}var u=r(74848),m=r(74602),h=r(47436),f=r(57324),p=r(94300),g=r(87204),v=r(61494),y=r(93345),x=r.n(y);const k=(0,y.createContext)(void 0);function b({controller:e,children:t}){return(0,u.jsx)(k.Provider,{value:{controller:e},children:t})}const w=(0,y.createContext)(void 0);function _({sanitizer:e,children:t}){return(0,u.jsx)(w.Provider,{value:{sanitizer:e},children:t})}const M=(0,y.createContext)(void 0);function T({expressions:e,rendermime:t,trusted:r,children:s}){return(0,u.jsx)(M.Provider,{value:{expressions:e,rendermime:t,trusted:r},children:s})}var j=r(57652),R=r(51247);class C extends R.Widget{constructor(){super(),this.addClass("myst-RenderedExpressionError")}}class S extends R.Widget{constructor(e){super(),this.trusted=e.trusted,this.expression=e.expression,this.rendermime=e.rendermime,this.safe=e.safe,this.addClass("myst-RenderedExpression"),(this.layout=new R.SingletonLayout).widget=new C}renderExpression(e){const t=this.layout;if(!t)return console.error("Our layout is already disposed!!"),Promise.resolve();if(this.isDisposed)return console.error("Our layout is already disposed!!"),Promise.resolve();let r;r="ok"===e.status?{trusted:this.trusted,data:e.data,metadata:e.metadata}:{data:{"application/vnd.jupyter.stderr":e.traceback.join("\n")||`${e.ename}: ${e.evalue}`}};const s=this.rendermime.createModel(r),n=this.rendermime.preferredMimeType(s.data,this.safe);if(void 0===n)return console.error("Couldn't find mimetype for ",s),t.widget=new C,Promise.resolve();const o=this.rendermime.createRenderer(n);return t.widget=o,console.assert(o.isAttached,"renderer was not attached!",o),o.renderModel(s)}}function P({content:e}){return e=e.replace(/^(["'])(.*)\1$/,"$2"),(0,u.jsx)("span",{children:e})}function E({error:e}){return(0,u.jsxs)("span",{className:"text-black p-2","data-mime-type":"application/vnd.jupyter.stderr",style:{backgroundColor:"var(--jp-rendermime-error-background, #F9DEDE)",fontFamily:"var(--jp-code-font-family, monospace)",fontSize:"var(--jp-code-font-size)"},children:[(0,u.jsx)("span",{className:"text-[#e75c58]",children:e.ename}),": ",e.evalue]})}function D({rendermime:e,trusted:t,expressionMetadata:r}){const s=(0,y.useRef)(null),[n,o]=(0,y.useState)(void 0);return(0,y.useEffect)(()=>{console.debug(`Creating inline renderer for  \`${r.expression}\``);const s=new S({expression:r.expression,trusted:t,rendermime:e,safe:"any"});return o(s),()=>{s.isAttached&&!s.node.isConnected?console.error(`Could not dispose of renderer for \`${r.expression}\`: node is not connected`):s.dispose()}},[e,r]),(0,y.useEffect)(()=>{const e=n;if(s.current&&e)return e.isAttached&&console.error(`Expression renderer for \`${r.expression}\` is already attached to another node`),R.Widget.attach(e,s.current),console.debug(`Attached expression renderer for \`${r.expression}\` to parent widget`),()=>{e.isAttached&&!e.node.isConnected?console.error(`Unable to detach expression renderer for \`${r.expression}\`: node is not connected`):e.isAttached&&(console.debug(`Detaching expression renderer for \`${r.expression}\``),R.Widget.detach(e))};console.debug(`Cannot attach expression renderer for \`${r.expression}\``)},[s,n]),(0,y.useEffect)(()=>{n&&r?n.renderExpression(r.result):console.debug(`Cannot render expression \`${r.expression}\``)},[n,r]),console.debug(`Rendering MIME bundle for expression: '${r.expression}'`),(0,u.jsx)("div",{ref:s,className:"not-prose inline-block"})}function A({value:e}){const{expressions:t,rendermime:r,trusted:s}=null!==(n=(0,y.useContext)(M))&&void 0!==n?n:{};var n;if(!t||!r)return(0,u.jsx)("code",{children:e});const o=null==t?void 0:t.find(t=>t.expression===e),i=null==o?void 0:o.result.data;return console.debug(`Rendering \`${e}\` inline ${s?"with":"without"} trust`),o?(console.debug(`Using MIME bundle for \`${e}\``,i),"text/plain"===r.preferredMimeType(null!=i?i:{},s?"any":"ensure")?(0,u.jsx)(P,{content:null==i?void 0:i["text/plain"]}):"error"===o.result.status?(console.debug("Error for",e,o.result),(0,u.jsx)(E,{error:o.result})):(0,u.jsx)(D,{rendermime:r,trusted:!!s,expressionMetadata:o})):(console.debug("No metadata for",e),(0,u.jsx)("code",{children:e}))}function I({checked:e,line:t,children:r}){const[s,n]=x().useState(null!=e&&e),{controller:o}=null!==(i=(0,y.useContext)(k))&&void 0!==i?i:{};var i;return(0,u.jsxs)("li",{className:"task-list-item",children:[(0,u.jsx)("input",{type:"checkbox",disabled:!o,className:"task-list-item-checkbox",checked:s,onClick:()=>{o&&void 0!==t&&(o({line:t-1,checked:!s}),n(!s))}}),r]})}function F({checked:e,line:t,children:r}){return"boolean"==typeof e?(0,u.jsx)(I,{checked:e,line:t,children:(0,u.jsx)(v.MyST,{ast:r})}):(0,u.jsx)("li",{children:(0,u.jsx)(v.MyST,{ast:r})})}const N={...v.DEFAULT_RENDERERS,mermaid:j.MermaidNodeRenderer,inlineExpression:({node:e})=>(0,u.jsx)(A,{value:e.value}),listItem:({node:e})=>{var t;return(0,u.jsx)(F,{checked:e.checked,line:null===(t=e.position)||void 0===t?void 0:t.start.line,children:e.children})},html:({node:e},t)=>{const{sanitizer:r}=null!==(s=(0,y.useContext)(w))&&void 0!==s?s:{};var s;return void 0!==r?(0,u.jsx)("span",{className:"jp-RenderedHTMLCommon not-prose",dangerouslySetInnerHTML:{__html:r.sanitize(e.value)}}):(0,u.jsx)("pre",{children:e.value})}};var U=r(29224),$=r(13967);async function L(e,t){const r=(0,U.Ub)("link,linkBlock",e);await Promise.all(r.map(async e=>{if(!e||!e.url)return;const r=t.resolver,s=e.url;if((0,$.updateLinkTextIfEmpty)(e,s),((null==r?void 0:r.isLocal)?r.isLocal(s):a.URLExt.isLocal(s))&&r)if(e.static){const t=await r.resolveUrl(s),n=await r.getDownloadUrl(t);e.urlSource=s,e.url=n}else e.internal=!0}))}class z extends f.VDomModel{get references(){return this._references}set references(e){this._references=e,this.stateChanged.emit()}get mdast(){return this._mdast}set mdast(e){this._mdast=e,this.stateChanged.emit()}get expressions(){return this._expressions}set expressions(e){this._expressions=e,this.stateChanged.emit()}get frontmatter(){return this._frontmatter}set frontmatter(e){this._frontmatter=e,this.stateChanged.emit()}}function W(){}class H extends f.VDomRenderer{constructor(e){const{model:t,resolver:r,linkHandler:s,rendermime:n,trusted:o,sanitizer:i}=e;super(t),this._trusted=!1,this._taskItemChanged=new m.Signal(this),this._resolver=r,this._linkHandler=s,this._rendermime=n,this._trusted=o,this._sanitizer=i,this._taskItemController=e=>this._taskItemChanged.emit(e),this.addClass("myst")}get taskItemChanged(){return this._taskItemChanged}get trusted(){return this._trusted}set trusted(e){this._trusted=e,this.update()}render(){if(console.debug("Re-rendering VDOM for MySTWidget",this.model,this._trusted),!this.model)return(0,u.jsx)("span",{children:"MyST Renderer!"});const{references:e,frontmatter:t,mdast:r,expressions:s}=this.model;return(0,u.jsx)(b,{controller:this._taskItemController,children:(0,u.jsx)(g.ThemeProvider,{theme:"undefined"==typeof document?g.Theme.light:"false"===document.body.dataset.jpThemeLight?g.Theme.dark:g.Theme.light,Link:(n=this._resolver,o=this._linkHandler,e=>{const t=x().useRef(null),{to:r}=e;return x().useEffect(()=>{t&&t.current&&n&&async function(e,t,r){let s=e.getAttribute("href")||"";const n=t.isLocal?t.isLocal(s):a.URLExt.isLocal(s);if(!s||!n)return;const o=e.hash;if(o){if(o===s)return void(e.target="_self");s=s.replace(o,"")}try{const n=await t.resolveUrl(s),i=decodeURIComponent(n);r&&r.handleLink(e,i,o);const a=await t.getDownloadUrl(n);e.href=a+o}catch(t){e.href=""}}(t.current,n,o)},[t,r]),(0,u.jsx)("a",{href:r,ref:t,className:e.className,children:e.children})}),renderers:N,setTheme:W,children:(0,u.jsx)(_,{sanitizer:this._sanitizer,children:(0,u.jsx)(T,{expressions:s,rendermime:this._rendermime,trusted:this._trusted,children:(0,u.jsx)(g.TabStateProvider,{children:(0,u.jsxs)(g.ArticleProvider,{kind:p.U.Article,references:e,frontmatter:t,children:[t&&(0,u.jsx)(h.FrontmatterBlock,{frontmatter:t}),(0,u.jsx)(v.MyST,{ast:r})]})})})})})});var n,o}}var O=r(60939),q=r(47125),J=r(59859),V=r(28212),B=r(54281),G=r(32133),K=r(97717),Y=r(21717),Q=r(85209),X=r(89685);const Z=()=>e=>{!async function(e){(0,U.Ub)("cite",e).forEach(async e=>{e.children&&e.children.length>0||(e.error=!0,e.children=[{type:"text",value:e.label}])})}(e)};async function ee(e,t){const r=t.resolver;if(!r)return;const s=(0,U.Ub)("image",e);await Promise.all(s.map(async e=>{if(!e||!e.url)return;const t=await r.resolveUrl(e.url);if(!t)return;const s=await r.getDownloadUrl(t);s&&(e.url=s)}))}function te(e){const t=e=>(0,O.mystParse)(e,{markdownit:{linkify:!0},directives:[G.cardDirective,...K.gridDirectives,Q.proofDirective,...X.exerciseDirectives,...Y.tabDirectives],roles:[]}),r=t(e);return(0,J.l)().use($.basicTransformationsPlugin,{parser:t}).runSync(r),r}function re(e){return"markdown"===e.model.type}class se extends i.MarkdownCell{constructor(e){var t,r,s;super(e),this._metadataJustChanged=!1,this._notebookRendermime=e.rendermime,this._attachmentsResolver=new d.AttachmentsResolver({parent:null!==(t=e.rendermime.resolver)&&void 0!==t?t:void 0,model:this.model.attachments}),this._mystModel=new z,this._mystWidget=new H({model:this._mystModel,rendermime:this._notebookRendermime,linkHandler:null!==(r=this._notebookRendermime.linkHandler)&&void 0!==r?r:void 0,resolver:this._attachmentsResolver,trusted:this.model.trusted,sanitizer:null!==(s=this._notebookRendermime.sanitizer)&&void 0!==s?s:void 0}),this._mystWidget.taskItemChanged.connect((e,t)=>this.setTaskItem(e,t)),this._renderer.dispose(),this._renderer=this._notebookRendermime.createRenderer("text/plain"),this.model.onTrustedChanged=()=>this.onModelTrustedChanged(),this._monitor.dispose(),this._monitor=this.createActivityMonitor(),this._handleRendered=this.onRenderedChanged,this.restoreExpressionsFromMetadata()}setTaskItem(e,t){const r=this.model.sharedModel.getSource().split("\n");r[t.line]=r[t.line].replace(/^(\s*(?:-|\*)\s*)(\[[\s|x]\])/,t.checked?"$1[x]":"$1[ ]"),this.model.sharedModel.setSource(r.join("\n"))}async onRenderedChanged(){if(this.rendered){if(this.placeholder)return void await this.updateFragmentMDAST();this.rendered&&await this.render()}else this.showEditor()}createActivityMonitor(){const e=new a.ActivityMonitor({signal:this.model.contentChanged,timeout:100});return this.ready.then(()=>{this.isDisposed||(console.debug("ready and connected activityStopped signal"),e.activityStopped.connect(()=>{console.debug("Activity monitor expired"),this.rendered&&!this._metadataJustChanged&&(console.debug("Updating cell!"),this.update()),this._metadataJustChanged=!1},this))}).catch(e=>{console.error("Failed to be ready",e)}),e}restoreExpressionsFromMetadata(){const e=c(this);void 0!==e&&(console.debug("Restoring expressions from metadata",e),this._mystWidget.model.expressions=e)}onModelTrustedChanged(){console.debug("trust changed",this.model.trusted),this._mystWidget.trusted=this.model.trusted,this.restoreExpressionsFromMetadata()}onMetadataChanged(e,t){console.debug("metadata changed",t),this._metadataJustChanged=!0,t.key===l?(console.debug("metadata changed",t),this.restoreExpressionsFromMetadata()):super.onMetadataChanged(e,t)}get attachmentsResolver(){return this._attachmentsResolver}get mystModel(){return this._mystModel}set mystModel(e){e!==this._mystModel&&this._mystModel.dispose(),this._mystModel=e,this._mystWidget.model=e}get fragmentMDAST(){return this._fragmentMDAST}async updateFragmentMDAST(){let e=te(this.model.sharedModel.getSource());this._attachmentsResolver&&(e=await async function(e,t){t=(0,q.copyNode)(t);try{await ee(t,{resolver:e})}catch(e){}return t}(this._attachmentsResolver,e)),e.type="block",this._fragmentMDAST=e}async render(){await this.updateFragmentMDAST(),this._mystWidget.node&&this.isAttached&&(await async function(e){var t;const r=e.widgets.filter(re).filter(e=>void 0!==e.fragmentMDAST),s=function(e){return{type:"root",children:e.map(e=>(0,q.copyNode)(e.fragmentMDAST))}}(r),{references:n,frontmatter:o,mdast:i}=await async function(e,t){var r;const s=[new $.WikiTransformer,new $.GithubTransformer,new $.DOITransformer,new $.RRIDTransformer],n=new V.T,o={cite:{order:[],data:{}},article:e},{frontmatter:i}=(0,$.getFrontmatter)(n,e.children[0]),a=(0,B.validatePageFrontmatter)(i,{property:"frontmatter",messages:{}}),d=new $.ReferenceState("<PATH>",{frontmatter:a,vfile:n});return(0,J.l)().use($.mathPlugin,{macros:null!==(r=null==a?void 0:a.math)&&void 0!==r?r:{}}).use($.glossaryPlugin).use($.abbreviationPlugin,{abbreviations:a.abbreviations}).use($.enumerateTargetsPlugin,{state:d}).use($.linksPlugin,{transformers:s}).use($.footnotesPlugin).use($.resolveReferencesPlugin,{state:d}).use(Z).use($.keysPlugin).runSync(e,n),await L(e,{resolver:t}),(0,$.reconstructHtmlTransform)(e),n.messages.length>0&&console.error(n.messages.map(e=>e.message).join("\n")),{references:o,frontmatter:a,mdast:e}}(s,null!==(t=e.rendermime.resolver)&&void 0!==t?t:void 0);r.forEach((e,t)=>{if(e.rendered){const r=new z;r.references=n,r.frontmatter=0===t?o:void 0,r.mdast=i.children[t],r.expressions=e.mystModel.expressions,e.mystModel=r}})}(this.parent),await this._mystWidget.renderPromise,this.inputArea.renderInput(this._mystWidget))}}class ne extends o.NotebookPanel.ContentFactory{createMarkdownCell(e){return e.contentFactory||(e.contentFactory=this),new se(e).initializeState()}}var oe=r(50053),ie=r(99816);const ae="text/markdown";class de extends H{constructor(e){var t,r,s,n;super({model:void 0,resolver:null!==(t=e.resolver)&&void 0!==t?t:void 0,linkHandler:null!==(r=e.linkHandler)&&void 0!==r?r:void 0,sanitizer:null!==(s=e.sanitizer)&&void 0!==s?s:void 0}),this.resolver=null!==(n=e.resolver)&&void 0!==n?n:void 0,this.node.dataset.mimeType=ae,this.addClass("jp-RenderedMySTMarkdown")}async renderModel(e){if(window.trigger)throw Error("triggered!");const t=te(e.data[ae]),{references:r,mdast:s,frontmatter:n}=await async function(e,t){var r;e=(0,q.copyNode)(e);const s=[new $.WikiTransformer,new $.GithubTransformer,new $.DOITransformer,new $.RRIDTransformer],n=new V.T,o={cite:{order:[],data:{}},article:e},{frontmatter:i}=(0,$.getFrontmatter)(n,e),a=(0,B.validatePageFrontmatter)(i,{property:"frontmatter",messages:{}}),d=new $.ReferenceState("<PATH>",{frontmatter:a,vfile:n});return(0,J.l)().use($.mathPlugin,{macros:null!==(r=null==a?void 0:a.math)&&void 0!==r?r:{}}).use($.glossaryPlugin).use($.abbreviationPlugin,{abbreviations:a.abbreviations}).use($.enumerateTargetsPlugin,{state:d}).use($.linksPlugin,{transformers:s}).use($.footnotesPlugin).use($.resolveReferencesPlugin,{state:d}).use(Z).use($.keysPlugin).runSync(e,n),await L(e,{resolver:t}),await ee(e,{resolver:t}),(0,$.reconstructHtmlTransform)(e),{references:o,frontmatter:a,mdast:e}}(t,this.resolver),o=new z;return o.references=r,o.mdast=s,o.frontmatter=n,this.model&&(o.expressions=this.model.expressions),this.model=o,console.debug("State changed",this),this.renderPromise||Promise.resolve()}}const le={safe:!0,mimeTypes:["text/markdown"],defaultRank:50,createRenderer:e=>new de(e)},ce=[{id:"jupyterlab-myst:content-factory",provides:o.NotebookPanel.IContentFactory,requires:[n.IEditorServices],autoStart:!0,activate:(e,t)=>{console.log("JupyterLab extension jupyterlab-myst is activated!");const r=t.factoryService.newInlineEditor;return new ne({editorFactory:r})}},{id:"jupyterlab-myst:executor",requires:[o.INotebookTracker],autoStart:!0,activate:(e,t)=>{console.log("Using jupyterlab-myst:executor"),o.NotebookActions.executed.connect(async(e,r)=>{const{notebook:s,cell:n}=r;await async function(e,t,r){console.debug("Executing cell, expressions",c(t));const s=r.find(t=>t.content===e),n=null==s?void 0:s.sessionContext;if(void 0===n)return;if(!function(e){return"markdown"===e.model.type}(t))return;console.debug(`Markdown cell ${t.model.id} was executed`),await t.updateFragmentMDAST();const o=await async function(e,t){var r,s,n;const o=null===(r=t.session)||void 0===r?void 0:r.kernel;if(!o)throw new Error("Session has no kernel.");const i=null!==(n=null===(s=e.mystModel)||void 0===s?void 0:s.mdast)&&void 0!==n?n:{},a=(0,U.Ub)("inlineExpression",i).map(e=>e.value),d=new Map(a.map((e,t)=>[`${t}`,e]));if(console.debug("Executing named expressions",d),0===d.size)return Promise.resolve([]);const l={};d.forEach((e,t)=>{l[t]=e});const c={code:"",user_expressions:l};return new Promise((e,t)=>{console.debug("Performing kernel request",c),o.requestExecute(c,!1).onReply=r=>{console.debug("Handling kernel response",r);const s=r.content;if("ok"!==s.status)return t("Kernel response was not OK");const n=[];for(const e in s.user_expressions){const r=d.get(e);if(void 0===r)return t("namedExpressions doesn't have key. This should never happen");const o={expression:r,result:s.user_expressions[e]};n.push(o)}return e(n)}})}(t,n);console.debug("Handling evaluated user expressions",o),o.length?(console.debug("Setting metadata, before:",c(t),"after:",o),function(e,t){e&&(e.model.setMetadata?e.model.setMetadata(l,t):e.model.metadata.set(l,t))}(t,o)):function(e){e&&(e.model.setMetadata?e.model.deleteMetadata(l):e.model.metadata.delete(l))}(t),t.model.trusted=!0}(s,n,t)})}},{id:"jupyterlab-myst:mime-renderer",requires:[oe.IRenderMimeRegistry],autoStart:!0,optional:[s.IMarkdownViewerTracker,ie.ISettingRegistry],activate:(e,t,r,s)=>{console.log("Using jupyterlab-myst:mime-renderer"),s&&s.load("@jupyterlab/markdownviewer-extension:plugin").then(e=>{e.set("hideFrontMatter",!1)}),t.addFactory(le)}}]},94300:(e,t,r)=>{var s;r.d(t,{U:()=>s}),function(e){e.Article="Article",e.Notebook="Notebook",e.Part="Part"}(s||(s={}))}}]);